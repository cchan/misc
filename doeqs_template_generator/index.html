<div style="width:80%;border:solid 1px #000000;padding:20px;margin:20px auto;">
	<h1>DOE Question Template Generator</h1>
	<small><i>requires JavaScript and JQuery and cookies to be enabled, which should be the default</i></small><br><br>
	<table border=1><tr><th colspan=5>Example - 4 phys 5 chem</th><tr><td>Name:<td><input value="Henry Hsu" disabled/><td>Subjects:<td><input value="4p5c" disabled/><td>x</table><br>
	<table border=1 id='nsform'><tr><th colspan=5>Template Generator</th></table>
	<button onclick="nsadd('','');">Add Another</button>
	<button onclick="genTemplate();generateLink();saveQCookie();selTemplate();">Generate Template</button>
	<button onclick="selTemplate();">Select Template</button><br>
	Permalink: <a id="doclink" href=""></a><br><br>
	<div id="html" style="border:solid 1px #000000;"><center>template to be here</center></div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="jquery-1.10.2.min.js">\x3C/script>')</script>
<script src="jquery.jsoncookie.js"></script>
<script>
function nsadd(n,s){$('#nsform').append('<tr><td>Name:<td><input class="name" value="'+n+'"/><td>Subjects:<td><input class="subj" value="'+s+'"/><td onclick="$(this).parents(\'tr\').remove();">x');}

var getarr={},cookiearr=$.cookie("qcook");
var a=location.search.substr(1).split('&');
for(var i=0;i<a.length;i++){
	var x=a[i].split('=');
	if(!x[0]||!x[1]){getarr=false;break;}
	getarr[x[0]]=x[1];
}
if(getarr){
	cookiearr=[];
	for(var key in getarr)if(getarr.hasOwnProperty(key))cookiearr.push([key,getarr[key]]);
}
if(cookiearr)
	if(cookiearr.length>0)for(var i=0;i<cookiearr.length;i++)nsadd(cookiearr[i][0],cookiearr[i][1]);
	else{var cookiearr=[];nsadd('','');}
else{var cookiearr=[];nsadd('','');}

function selTemplate(){
	if(window.getSelection())
		window.getSelection().selectAllChildren(document.getElementById('html'));
	else
		alert("Your browser doesn't support selection properly D: You can probably just manually select the entire document and that'll do just fine.");
}
function generateLink(){
	var names=$(".name");
	getstr="?";
	names.each(function(){getstr+=encodeURIComponent(this.value)+'='+encodeURIComponent($(".subj").get(names.index(this)).value)+'&';});
	var linktext=location.origin+location.pathname+getstr.substr(0,getstr.length-1);
	$("#doclink").text(linktext).attr('href',linktext);
}generateLink();
function saveQCookie(){
	cookiearr=[];
	$(".name").each(function(){cookiearr.push([this.value,$(".subj").get($(".name").index(this)).value]);});
	$.cookie("qcook",cookiearr);
}
function genTemplate(){
	var qarr=[];
	$(".name").each(function(){
		var sv=$(".subj").get($(".name").index(this)).value;
		for(var i=0;i<sv.length;i+=2){
			if(!parseInt(sv[i])){alert("Invalid subject number for '"+this.value+"'");return false;}
			if(!(s=({b:"BIOLOGY",c:"CHEMISTRY",p:"PHYSICS",m:"MATH",e:"EARTH AND SPACE SCIENCE"})[sv[i+1].toLowerCase()])){alert("Invalid subject for '"+this.value+"'");return false;}
			for(var j=0;j<parseInt(sv[i]);j++)
				qarr.push([s,this.value]);
		}
	});
	qarr=mooShuffle(qarr);
	
	var fullhtml="<p style='text-align:center;font-weight:bold;'>[[team]]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOE Questions&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[date]]</p>";
	for(var i=0;i<qarr.length;i++)
		fullhtml+="<p style='text-align:center;font-weight:bold;'>TOSS-UP</p>"
			+"<div style='font-weight:normal;'>"+qarr[i][0]+" <i>Question Type</i> "+qarr[i][1]+"</div>"
			+"<div style='font-weight:normal;'>ANSWER:&nbsp;</div>"
			+"<p style='text-align:center;font-weight:bold;'>BONUS</p>"
			+"<div style='font-weight:normal;'>"+qarr[i][0]+" <i>Question Type</i> "+qarr[i][1]+"</div>"
			+"<div style='font-weight:normal;'>ANSWER:&nbsp;</div>"
			+"<br>";
	$("#html").html(fullhtml);
}

function mooShuffle(arr){//Fisher-Yates Shuffle, but which I discovered myself independently. So I get to name it ^^
	var ind,tmp;
	for(var i=arr.length-1;i>0;i--){
		ind=Math.floor(Math.random()*i);//Get random one
		tmp=arr[i];arr[i]=arr[ind];arr[ind]=tmp;//Swap with last one in sorted area
	}
	return arr;
}
</script>